import pyautogui
import time
import datetime
import os

# Configurar directorios
imagenes_dir = 'imagenes'
pdf_dir = 'pdfs'

# Crear directorios si no existen
os.makedirs(imagenes_dir, exist_ok=True)
os.makedirs(pdf_dir, exist_ok=True)

# Lista de RUCs
rucs = [    
            
            '20565452712',
            '20385994886',
            '20504052908',
            '20393613450',
            '20453685137',
            '20509523127',
            '20504062539',
            '20564114538',
            '20440211969',
            '20489980208',
            '20546078907',
            '20531583150',
            '20499533480',
            '20601465109',
            '20511314101',
            '20600510844',
            '20561394947',
            '20437481734',
            '20552062281',
            '20544682611',
            '20566106265',
            '20550177359',
            '20609502941',
            '20510938951',
            '20470993406',
            '20551937896',
            '20487888827',
            '20602946232',
            '20600300289',
            '20137116741',
            '20263037295',
            '20563054167',
            '20440286381',
            '20600196961',
            '20451769597',
            '20519035449',
            '20563498987',
            '20544747844',
            '20600552741',
            '20556944785',
            '20310209644',
            '20519143926',
            '20487128784',
            '20551265774',
            '20547972903',
            '20559652262',
            '20498062564',
            '20556830267',
            '20601939771',
            '20103882444',
            '20356947810',
            '20262867944',
            '20383468575',
            '20536159887',
            '20330130947',
            '20417952471',
            '20498579770',
            '20306228987',
            '20466607810',
            '20507488472',
            '20536733338',
            '20397167128',
            '20419894835',
            '20493330218',
            '20515367978',
            '20454829442',
            '20528200908',
            '20455075212',
            '20550592330',
            '20218681833',
            '20528096060',
            '20574649685',
            '20212543986',
            '20119244847',
            '20532411077',
            '20523958446',
            '20301966351',
            '20549644717',
            '20487410960',
            '20505166524',
            '20535557480',
            '20126969903',
            '20479513563',
            '20443395793',
            '20482494189',
            '20524254337',
            '20451415604',
            '20433751303',
            '20387094611',
            '20543694682',
            '20602271596',
            '20556884430',
            '20606519487',
            '20533159339',
            '20546354351',
            '20529396318',
            '20409229973',
            '20600292855',
            '20455900035',
            '20100962862',
            '20486859866',
            '20600263227',
            '20177718506',
            '20292598794',
            '20506714533',
            '20524324483',
            '20101038433',
            '20393323028',
            '20455684316',
            '20525196837',
            '20552726970',
            '20427320449',
            '20507036814',
            '20500337592',
            '20515768611',
            '20512142185',
            '20525028705',
            '20535928054',
            '20365284190',
            '20510278098',
            '20521710676',
            '20538415384',
            '20556013056',
            '20600211189',
            '20600794214',
            '20601475112',
            '20601657326',
            '20601793220',
            '20600617525',
            '20600112741',
            '20537670526',
            '20447715351',
            '20527521913',
            '20478066407',
            '20603180403',
            '20524789958',
            '20568966601',
            '20601839378',
            '20492672239',
            '20476753679',
            '20513688947',
            '20518814274',
            '20100385962',
            '20416651494',
            '20482115773',
            '20551845771',
            '20554791434',
            '20603012659',
            '20469555365',
            '20453655491',
            '20603178280',
            '20600648901',
            '20481449180',
            '20485841793',
            '20450343642',
            '20511657645',
            '20522749070',
            '20480132522',
            '20526814640',
            '20409280651',
            '20481522529',
            '20479794988',
            '20490138413',
            '20523708172',
            '20555160578',
            '20549349391',
            '20530212638',
            '20472174402',
            '20552966938',
            '20393766442',
            '20555488620',
            '20331443850',
            '20600366484',
            '20434395888',
            '20480065663',
            '20565493664',
            '20391197653',
            '20546894461',
            '20454972245',
            '20504391273',
            '20532904006',
            '20550582296',
            '20502969111',
            '20601734622',
            '20392595831',
            '20451165225',
            '20214337054',
            '20324952579',
            '20555136359',
            '20386578959',
            '20391285439',
            '20482082743',
            '20538838188',
            '20453776281',
            '20214014557',
            '20514109983',
            '20468024978',
            '20601712955',
            '20534477245',
            '20121222095',
            '20397693954',
            '20538123251',
            '20572159419',
            '20548612498',
            '20519883881',
            '20601824451',
            '20408070989',
            '20552662041',
            '20565786254',
            '20384257063',
            '20259700711',
            '20313629628',
            '20490101412',
            '20600197640',
            '20571598044',
            '20547985801',
            '20600671716',
            '20506958751',
            '20135520706',
            '20502964403',
            '20600156196',
            '20546452795',
            '20553932905',
            '20487486869',
            '20352446891',
            '20415330309',
            '20257434827',
            '20294562088',
            '20560204541',
            '20536295713',
            '20552245955',
            '20492129331',
            '20554945172',
            '20600928113',
            '20437137529',
            '20498043691',
            '20549723773',
            '20527084351',
            '20263870604',
            '20530911056',
            '20602092365',
            '20110355581',
            '20508173181',
            '20606072164',
            '20495012698',
            '20517000311',
            '20563673908',
            '20392740351',
            '20569113165',
            '20492595901',
            '20492777171',
            '20225183059',
            '20102903171',
            '20450729087',
            '20571254205',
            '20390597623',
            '20487932745',
            '20434901252',
            '20455717346',
            '20524190690',
            '20315722587',
            '20536470817',
            '20601986079',
            '20397957447',
            '20602935842',
            '20600183932',
            '20505063806',
            '20108669951',
            '20600874358',
            '20557160214',
            '20447758165',
            '20513346124',
            '20540019674',
            '20553914591',
            '20530032656',
            '20527498831',
            '20491747995',
            '20571451965',
            '20565458834',
            '20600482476',
            '20534361611',
            '20490569155',
            '20101483917',
            '20454721838',
            '20489574391',
            '20509065404',
            '20516428130',
            '20445489337',
            '20556293318',
            '20380402867',
            '20512961097',
            '20384393676',
            '20373620425',
            '20517697321',
            '20339022047',
            '20532612722',
            '20482708162',
            '20571459788',
            '20102841558',
            '20102079834',
            '20495883648',
            '20326314529',
            '20117471081',
            '20551312870',
            '20524769761',
            '20548138486',
            '20558669374',
            '20564001687',
            '20470247143',
            '20503276551',
            '20517362817',
            '20537110733',
            '20563955041',
            '20523843461',
            '20549615458',
            '20118436629',
            '20106520730',
            '20445353273',
            '20393935571',
            '20449289146',
            '20545527007',
            '20269423065',
            '20558040018',
            '20267446793',
            '20535369217',
            '20565555449',
            '20455995079',
            '20480518986',
            '20571373042',
            '20393511291',
            '20609419408',
            '20503964105',
            '20527559996',
            '20601245044',
            '20519694132',
            '20309356323',
            '20483687789',
            '20455610622',
            '20502821556',
            '20521586568',
            '20603177372',
            '20603179766',
            '20600056345',
            '20268841441',
            '20515718606',
            '20543223302',
            '20110493208',
            '20379052089',
            '20511435405',
            '20530141358',
            '20468405009',
            '20536212877',
            '20549488324',
            '20481945756',
            '20566081173',
            '20570796225',
            '20601094895',
            '20562836501',
            '20550321221',
            '20440276742',
            '20145107700',
            '20296848809',
            '20600995546',
            '20188886966',
            '20504356443',
            '20604096066',
            '20130443681',
            '20455937460',
            '20603529406',
            '20552690924',
            '20605797475',
            '20440148078',
            '20211624001',
            '20479468916',
            '20571605601',
            '20551357547',
            '20600228545',
            '20207548937',
            '20408108200',
            '20482439323',
            '20554354484',
            '20400203491',
            '20547871031',
            '20549597379',
            '20409482016',
            '20570723422',
            '20550284511',
            '20390242418',
            '20553126054',
            '20479463876',
            '20489520894',
            '20517182835',
            '20209140170',
            '20456242007',
            '20518743407',
            '20519492424',
            '20523062485',
            '20554624295',
            '20600128729',
            '20492264033',
            '20461075437',
            '20172710671',
            '20543726711',
            '20557705148',
            '20530945384',
            '20136917979',
            '20495573371',
            '20519911508',
            '20107756559',
            '20224659530',
            '20503140650',
            '20533900217',
            '20491710641',
            '20600986521',
            '20449359454',
            '20454597487',
            '20480807074',
            '20512128786',
            '20102828454',
            '20515667424',
            '20337765352',
            '20103554943',
            '20544451058',
            '20608020323',
            '20503447381',
            '20528397779',
            '20331072932',
            '20450657663',
            '20600169727',
            '20600585763',
            '20543117375',
            '20454089651',
            '20523427670',
            '20555079452',
            '20527495068',
            '20477930418',
            '20529683481',
            '20531460821',
            '20516127369',
            '20557917919',
            '20101184332',
            '20474170153',
            '20472102240',
            '20601168988',
            '20600262387',
            '20510514913',
            '20604433020',
            '20514301663',
            '20539604644',
            '20601181097',
            '20601615551',
            '20543394379',
            '20554170596',
            '20602392016',
            '20288062057',
            '20409402781',
            '20367195674',
            '20481435987',
            '20557067354',
            '20330518597',
            '20537205874',
            '20526033401',
            '20515639561',
            '20529669900',
            '20600601289',
            '20543598535',
            '20600787111',
            '20537310155',
            '20519078415',
            '20568070047',
            '20487771474',
            '20349256151',
            '20406456081',
            '20456257292',
            '20539614879',
            '20554901809',
            '20412602898',
            '20138487343',
            '20526924402',
            '20527318361',
            '20512798757',
            '20160258528',
            '20427901760',
            '20339588032',
            '20521130084',
            '20601407401',
            '20100732603',
            '20477739548',
            '20486241544',
            '20386161373',
            '20549991514',
            '20600234421',
            '20372789396',
            '20477457992',
            '20537181088',
            '20529450037',
            '20536972910',
            '20545690251',
            '20538833038',
            '20548558850',
            '20410974429',
            '20131024143',
            '20553687595',
            '20525585060',
            '20552604602',
            '20419816524',
            '20512743189',
            '20511379815',
            '20543723968',
            '20549963731',
            '20456167978',
            '20494229464',
            '20553799989',
            '20600049853',
            '20284639104',
            '20264293660',
            '20549725636',
            '20514641171',
            '20601222745',
            '20600317564',
            '20477362851',
            '20523785592',
            '20541104217',
            '20533728562',
            '20571479975',
            '20484155802',
            '20214786011',
            '20425548981',
            '20514728705',
            '20554340777',
            '20491934591',
            '20430495853',
            '20600176162',
            '20559674070',
            '20563306077',
            '20477677500',
            '20495022065',
            '20516924463',
            '20550205077',
            '20489971985',
            '20213900626',
            '20600370961',
            '20527696390',
            '20601607876',
            '20501276058',
            '20531543956',
            '20546172831',
            '20456296191',
            '20368320375',
            '20559906540',
            '20518332016',
            '20514081361',
            '20549005382',
            '20448362974',
            '20507126724',
            '20454957441',
            '20509895181',
            '20484109444',
            '20515150219',
            '20130899499',
            '20463164283',
            '20600865642',
            '20530675492',
            '20510509243',
            '20496841779',
            '20453499261',
            '20558249677',
            '20413535205',
            '20600443039',
            '20602116566',
            '20101084621',
            '20537077264',
            '20601564565',
            '20571108055',
            '20482437541',
            '20487820432',
            '20489723060',
            '20546614442',
            '20454519338',
            '20454741863',
            '20107411063',
            '20254100413',
            '20454948298',
            '20389709841',
            '20601289360',
            '20455353395',
            '20509806421',
            '20456348417',
            '20539309561',
            '20516186888',
            '20528131663',
            '20452358400',
            '20557067354',
            '20601181275',
            '20434321175',
            '20504221271',
            '20484290416',
            '20547660413',
            '20112346237',
            '20601403022',
            '20528994602',
            '20516231425',
            '20606731214',
            '20536851021',
            '20523483669',
            '20158829135',
            '20447606811',
            '20494635021',
            '20498411241',
            '20136143426',
            '20507095233',
            '20570821785',
            '20495883648',
            '20393194899',
            '20600231309',
            '20491128403',
            '20393078121',
            '20529807474',
            '20563301865',
            '20425860489',
            '20606260556',
            '20424370429',
            '20118000847',
            '20298117178',
            '20538589706',
            '20479933422',
            '20421010367',
            '20122839037',
            '20544669860',
            '20389666859',
            '20256658721',
            '20553009333',
            '20135491170',
            '20513600365',
            '20601212685',
            '20546077765',
            '20600599373',
            '20380181917',
            '20601203082',
            '20490950151',
            '20600801440',
            '20477531637',
            '20112292803',
            '20409203150',
            '20524267072',
            '20539680316',
            '20573143974',
            '20493623665',
            '20600302877',
            '20534853166',
            '20600637518',
            '20552755058',
            '20543591361',
            '20600008383',
            '20565496507',
            '20533312463',
            '20486333660',
            '20351042240',
            '20556628948',
            '20549204741',
            '20456275193',
            '20519235880',
            '20347197212',
            '20495731970',
            '20526692510',
            '20145053774',
            '20106614394',
            '20517577180',
            '20543425436',
            '20556169811',
            '20558352923',
            '20548425973',
            '20176190800',
            '20600982134',
            '20506178071',
            '20467490738',
            '20607828807',
            '20515104705',
            '20547162812',
            '20601519420',
            '20601621267',
            '20196563653',
            '20491072939',
            '20601305390',
            '20514094935',
            '20521852462',
            '20529029161',
            '20541268325',
            '20471307433',
            '20428799756',
            '20390333219',
            '20480080115',
            '20378120307',
            '20600388615',
            '20513950421',
            '20114543641',
            '20549837515',
            '20477765468',
            '20601208203',
            '20445679896',
            '20523580192',
            '20458517453',
            '20563186667',
            '20430049489',
            '20513312149',
            '20510858922',
            '20600866037',
            '20136840062',
            '20480997779',
            '20495012698',
            '20296888690',
            '20484295647',
            '20529750936',
            '20263431783',
            '20434850321',
            '20392462792',
            '20101445667',
            '20146690433',
            '20506413339',
            '20600858301',
            '20101781772',
            '20274449978',
            '20279265689',
            '20377218753',
            '20439002345',
            '20505184263',
            '20516801892',
            '20519934893',
            '20523483669',
            '20525772765',
            '20530184324',
            '20539452950',
            '20600049021',
            '20600431561',
            '20301505893',
            '20507085513',
            '20174217433',
            '20223005803',
            '20502475208',
            '20536937502',
            '20448773761',
            '20482790829',
            '20510342012',
            '20266415355',
            '20406477674',
            '20480906307',
            '20496103786',
            '20601510937',
            '20603351852',
            '20603574550',
            '20202392475',
            '20495045197',
            '20527727881',
            '20529069546',
            '20492332721',
            '20448879322',
            '20519269512',
            '20551905269',
            '20530825729',
            '20462608641',
            '20406354165',
            '20558599571',
            '20101976191',
            '20294683977',
            '20502232721',
            '20511743487',
            '20465209471',
            '20492395057',
            '20303354906',
            '20523221621',
            '20100000769',
            '20128818864',
            '20600074009',
            '20570865561',
            '20600444124',
            '20507094938',
            '20557654217',
            '20448623280',
            '20548583021',
            '20176330075',
            '20413330069',
            '20362741077',
            '20537650843',
            '20267356450',
            '20512878432',
            '20541132342',
            '20133831461',
            '20492828344',
            '20515655761',
            '20477694421',
            '20563341735',
            '20538017494',
            '20452996350',
            '20101332111',
            '20125797131',
            '20607072125',
            '20505111894',
            '20519942217',
            '20600523504',
            '20601416795',
            '20600309154',
            '20428969341',
            '20603230826',
            '20490621335',
            '20490973878',
            '20503271321',
            '20544457412',
            '20548644268',
            '20418836696',
            '20251454532',
            '20406406068',
            '20603088175',
            '20512949551',
            '20206575701',
            '20455886296',
            '20337957936',
            '20521136520',
            '20481405212',
            '20510934963',
            '20504128149',
            '20600104102',
            '20137843961',
            '20153683574',
            '20492884929',
            '20526996900',
            '20529516828',
            '20500494698',
            '20565859588',
            '20600172736',
            '20604273669',
            '20601567122',
            '20101921370',
            '20504339948',
            '20507709070',
            '20600035577',
            '20122338330',
            '20463359297',
            '20503302498',
            '20563143003',
            '20258406231',
            '20531469969',
            '20534289244',
            '20101849083',
            '20548654573',
            '20517416411',
            '20498445901',
            '20546263399',
            '20269276925',
            '20477532790',
            '20503213711',
            '20495377602',
            '20551819427',
            '20482433635',
            '20336180261',
            '20207799425',
            '20482453741',
            '20498600990',
            '20550191181',
            '20100916241',
            '20109826261',
            '20601129354',
            '20563746808',
            '20600116712',
            '20106933228',
            '20480684215',
            '20521220661',
            '20536085581',
            '20100550831',
            '20373653196',
            '20600982649',
            '20601229413',
            '20605123016',
            '20480329741',
            '20114921344',
            '20534091649',
            '20465114097',
            '20534752564',
            '20379515798',
            '20454424388',
            '20479352021',
            '20423554887'

]  

btn_buscar = "btn_buscar.png"
btn_guardar = "btn_guardar.png"
btn_volver = "btn_volver.png"
input_ruc = "input_ruc.png"
img_error = "error.png"

# Función para encontrar la imagen
def encontrar_imagen(image_path):
    time.sleep(5)
    variable = pyautogui.locateCenterOnScreen(image_path, grayscale=True, confidence=0.8)
    while variable is None:
        time.sleep(5)
        variable = pyautogui.locateCenterOnScreen(image_path, grayscale=True, confidence=0.7)
        print('No se encontró '+image_path)
    return variable

time.sleep(5)
for ruc in rucs:
    while True:  # Bucle para manejar errores
        # Asume que la página está abierta y lista para interactuar

        # Ingresar el RUC
        posicion_input_ruc = encontrar_imagen(input_ruc)
        pyautogui.click(posicion_input_ruc)
        time.sleep(1)
        pyautogui.write(ruc)
        time.sleep(3)
        posicion_btn_buscar = encontrar_imagen(btn_buscar)
        pyautogui.click(posicion_btn_buscar)

        time.sleep(5)  # Esperar a que la página cargue

        # Verificar si se ha producido un error
        if pyautogui.locateCenterOnScreen(img_error, grayscale=True, confidence=0.5) is not None:
            print(f"Error encontrado con el RUC {ruc}, intentando de nuevo...")
            pyautogui.hotkey('alt', 'left')  # Volver a la página anterior
            time.sleep(3)
            continue  # Reintentar con el mismo RUC
        # Volver a la página principal
        posicion_btn_volver = encontrar_imagen(btn_volver)
        if posicion_btn_volver  is  None:
            time.sleep(15)
        # Capturar pantalla del resultado
        fecha = datetime.datetime.now().strftime('%Y%m%d')
        screenshot_path = os.path.join(imagenes_dir, f'{ruc}_{fecha}.png')
        pyautogui.screenshot(screenshot_path)

        # Simular Ctrl + P para abrir el diálogo de impresión
        pyautogui.hotkey('ctrl', 'p')
        time.sleep(2)
        pyautogui.press('enter')
        time.sleep(3)

        # Escribir el nombre del archivo PDF y guardarlo
        pdf_path = f'{ruc}_{fecha}.pdf'
        pyautogui.write(pdf_path)
        pyautogui.press('enter')

        time.sleep(3)  # Esperar para asegurarse que el proceso haya finalizado

        # Volver a la página principal
        posicion_btn_volver = encontrar_imagen(btn_volver)
        pyautogui.click(posicion_btn_volver)
        time.sleep(3)
        break  # Salir del bucle si no hubo errores

print("Proceso completado.")
